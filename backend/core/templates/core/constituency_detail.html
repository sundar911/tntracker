<!DOCTYPE html>
<html lang="en">
  {% load indian_numbers %}
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ constituency.name }} - Candidates</title>
    <link rel="stylesheet" href="/static/core/site.css" />
  </head>
  <body>
    <header class="site-header compact">
      <div class="container nav">
        <a class="brand-link" href="/">
          <div class="brand">
            <span class="brand-mark">TN</span>
            <div class="brand-text">
              <div class="brand-title">
                {% if current_language == "ta" %}தமிழ்நாடு தேர்தல் தரவகம்{% else %}Tamil Nadu Election Hub{% endif %}
              </div>
              <div class="brand-subtitle">
                {% if current_language == "ta" %}2026 சட்டமன்றத் தேர்தல்{% else %}Assembly Elections 2026{% endif %}
              </div>
            </div>
          </div>
        </a>
        <div class="nav-actions">
          <button class="theme-toggle" type="button" data-theme-toggle>
            {% if current_language == "ta" %}இருண்ட தோற்றம்{% else %}Dark mode{% endif %}
          </button>
        </div>
      </div>
    </header>
    <main class="container">
      <div class="topbar">
        <div class="lang">
          <a class="link" href="/set-lang/en/?next={{ request.get_full_path|urlencode }}">English</a>
          <span> | </span>
          <a class="link" href="/set-lang/ta/?next={{ request.get_full_path|urlencode }}">தமிழ்</a>
        </div>
      </div>
      {% if data_vintage_label %}
      <div class="banner">{{ data_vintage_label }}</div>
      {% endif %}
      <a class="link" href="/map/">← {% if current_language == "ta" %}வரைபடம்{% else %}Back to map{% endif %}</a>
      <h1>
        {% if current_language == "ta" and constituency.name_ta %}{{ constituency.name_ta }}{% else %}{{ constituency.name }}{% endif %}
      </h1>
      <p class="muted">
        {% if current_language == "ta" and constituency.district_ta %}{{ constituency.district_ta }}{% else %}{{ district_name }}{% endif %}
      </p>

      <section class="card">
        <h2>{% if current_language == "ta" %}சுருக்கம்{% else %}Summary{% endif %}</h2>
        <div class="stat-grid">
          {% for stat in summary_cards %}
          <div class="stat-card">
            <div class="stat-value">{{ stat.value }}</div>
            <div class="stat-label">{{ stat.label }}</div>
          </div>
          {% endfor %}
        </div>
      </section>

      <section class="card">
        <h2>{% if current_language == "ta" %}வேட்பாளர்கள்{% else %}Candidates{% endif %}</h2>
        <div class="candidate-grid">
          {% for candidate in candidate_cards %}
          <div class="candidate-card">
            <div class="candidate-header">
              <div>
                <div class="candidate-name">{{ candidate.name }}</div>
                <div class="muted">{{ candidate.party }}</div>
              </div>
              <div class="candidate-badges">
                {% if candidate.party_symbol %}
                  <img
                    class="party-symbol"
                    src="{{ candidate.party_symbol }}"
                    alt="{{ candidate.party }} symbol"
                    loading="lazy"
                  />
                {% endif %}
                {% if candidate.sitting %}
                  <span class="tag">{% if current_language == "ta" %}தற்போதைய எம்.எல்.ஏ{% else %}Sitting MLA{% endif %}</span>
                {% endif %}
              </div>
            </div>
            <div class="candidate-meta">
              {% if candidate.education %}<span>{% if current_language == "ta" %}கல்வி{% else %}Education{% endif %}: {{ candidate.education }}</span>{% endif %}
              {% if candidate.age %}<span>{% if current_language == "ta" %}வயது{% else %}Age{% endif %}: {{ candidate.age|indian }}</span>{% endif %}
              {% if candidate.criminal_cases is not None %}<span>{% if current_language == "ta" %}வழக்குகள்{% else %}Cases{% endif %}: {{ candidate.criminal_cases|indian }}</span>{% endif %}
              <span>{% if current_language == "ta" %}சொத்துகள்{% else %}Assets{% endif %}: {% if candidate.assets %}₹ {{ candidate.assets|indian }}{% else %}N/A{% endif %}</span>
              <span>{% if current_language == "ta" %}பாக்கிகள்{% else %}Liabilities{% endif %}: {% if candidate.liabilities %}₹ {{ candidate.liabilities|indian }}{% else %}N/A{% endif %}</span>
            </div>
            {% if candidate.key_promises %}
              <div class="promise-tags" aria-label="Key manifesto promises">
                {% for promise in candidate.key_promises %}
                  <span>{{ promise.text }}</span>
                {% endfor %}
              </div>
            {% endif %}
            {% if candidate.sitting and candidate.state_delivery %}
              <div class="fulfilment-block" aria-label="Promise fulfilment summary">
                <div class="fulfilment-row">
                  <strong>{% if current_language == "ta" %}மாநிலம்{% else %}State{% endif %}</strong>
                  <span class="muted">
                    {% if candidate.state_delivery.claim_percent %}
                      {% if current_language == "ta" %}கூற்று{% else %}Claim{% endif %}: {{ candidate.state_delivery.claim_percent }}
                    {% elif candidate.state_delivery.avg_score is not None %}
                      {% if current_language == "ta" %}சராசரி மதிப்பெண்{% else %}Avg score{% endif %}: {{ candidate.state_delivery.avg_score }}
                    {% else %}
                      {% if current_language == "ta" %}உறுதிப்படுத்தப்படவில்லை{% else %}Unverified{% endif %}
                    {% endif %}
                  </span>
                  {% if candidate.state_delivery.claim_url %}
                    <a class="link" href="{{ candidate.state_delivery.claim_url }}" target="_blank" rel="noopener">
                      {% if current_language == "ta" %}மூலம்{% else %}Source{% endif %}
                    </a>
                  {% endif %}
                </div>
                {% if candidate.state_delivery.summary %}
                  <div class="fulfilment-summary">{{ candidate.state_delivery.summary }}</div>
                {% endif %}
                <div class="fulfilment-row">
                  <strong>{% if current_language == "ta" %}தொகுதி{% else %}Constituency{% endif %}</strong>
                  <span class="muted">
                    {% if candidate.constituency_delivery and candidate.constituency_delivery.avg_score is not None %}
                      {% if current_language == "ta" %}சராசரி மதிப்பெண்{% else %}Avg score{% endif %}: {{ candidate.constituency_delivery.avg_score }}
                    {% elif candidate.constituency_delivery and candidate.constituency_delivery.summary %}
                      {% if current_language == "ta" %}சுருக்கம்{% else %}Summary{% endif %}
                    {% else %}
                      {% if current_language == "ta" %}உறுதிப்படுத்தப்படவில்லை{% else %}Unverified{% endif %}
                    {% endif %}
                  </span>
                </div>
                {% if candidate.constituency_delivery and candidate.constituency_delivery.summary %}
                  <div class="fulfilment-summary">{{ candidate.constituency_delivery.summary }}</div>
                {% endif %}
              </div>
            {% endif %}
          </div>
          {% empty %}
          <p>{% if current_language == "ta" %}வேட்பாளர்கள் இல்லை.{% else %}No candidates loaded yet.{% endif %}</p>
          {% endfor %}
        </div>
      </section>
    </main>
    <script>
      const themeToggles = document.querySelectorAll("[data-theme-toggle]");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const storedTheme = localStorage.getItem("theme");
      const isDark = storedTheme ? storedTheme === "dark" : prefersDark;

      const applyTheme = (dark) => {
        document.body.classList.toggle("theme-dark", dark);
        localStorage.setItem("theme", dark ? "dark" : "light");
        themeToggles.forEach((btn) => {
          btn.textContent = dark
            ? "{% if current_language == 'ta' %}ஒளி தோற்றம்{% else %}Light mode{% endif %}"
            : "{% if current_language == 'ta' %}இருண்ட தோற்றம்{% else %}Dark mode{% endif %}";
        });
      };

      applyTheme(isDark);
      themeToggles.forEach((btn) => {
        btn.addEventListener("click", () => applyTheme(!document.body.classList.contains("theme-dark")));
      });
    </script>
  </body>
</html>
